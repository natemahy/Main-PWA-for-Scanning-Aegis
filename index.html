<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLX Fleet Manager</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
</head>
<body>

    <header>
        <div class="logo">PLX TRACKER</div>
        <div class="toggle-container" onclick="toggleMode()">
            <div id="mode-label">WAREHOUSE</div>
            <div id="mode-icon">üè≠</div>
        </div>
    </header>

    <main>
        <div class="scanner-container">
            <video id="camera-feed" autoplay playsinline muted></video>
            <canvas id="overlay-canvas"></canvas>
            <div class="overlay-text">
                <div class="scan-frame"></div>
                <p id="system-status" style="color: yellow;">Initializing...</p>
            </div>
        </div>

        <div class="uwb-container">
            <h3>System Log</h3>
            <div id="log-feed" style="font-size: 12px; color: #94a3b8; overflow-y: auto; height: 100%;"></div>
        </div>
    </main>

    <footer>
        <button id="btn-connect" onclick="connectToUWB()">Connect UWB Tool</button>
    </footer>

    <script src="plx-reader.js"></script>
    <script src="app.js"></script>
    
    <script async src="https://docs.opencv.org/4.5.4/opencv.js" onload="onOpenCvReady();" onerror="onOpenCvError();"></script>

    <script>
        function onOpenCvReady() {
            console.log("OpenCV Loaded!");
            // Tell app.js it is safe to start scanning
            if(window.enableVision) window.enableVision(); 
            document.getElementById('system-status').innerText = "Vision Ready - Align Tag";
            document.getElementById('system-status').style.color = "#10b981"; // Green
        }
        function onOpenCvError() {
            document.getElementById('system-status').innerText = "Vision Failed to Load";
            document.getElementById('system-status').style.color = "red";
        }
    </script>
</body>
</html>