<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLX Fleet Manager</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script async src="https://docs.opencv.org/4.5.0/opencv.js" type="text/javascript"></script>
</head>
<body>

    <div class="app-container">
        
        <header>
            <label for="customer-select" style="font-size: 0.8rem; color: #a0a0a0;">Active Customer</label>
            <select id="customer-select" class="customer-dropdown">
                <option>Loading...</option>
            </select>
        </header>

        <div id="tab-register" class="view">
            <h2>Register New Asset</h2>
            <input type="text" id="vin-input" placeholder="Enter Full VIN" class="input-field">
            
            <div class="info-box">
                <p>Next PLX ID:</p>
                <h1 id="next-plx-display">--</h1>
            </div>

            <button id="generate-btn" class="primary-btn">Generate & Save</button>
            <p id="reg-status" class="status-text"></p>

            <div id="tag-preview-area" class="hidden" style="margin-top:20px; text-align:center;">
                <p style="color:#aaa; margin-bottom:10px;">Tag Generated:</p>
                <canvas id="tag-canvas" width="300" height="300" style="width:150px; height:150px; border:1px solid #444; background: white;"></canvas>
                <br>
                <button id="print-btn" class="secondary-btn" style="margin-top:10px;">Print Label</button>
            </div>
        </div>

        <div id="tab-scan" class="view active">
            <p class="instruction-text">Scan tag to update location.</p>
            <div class="video-container"></div> 
            <button id="scan-btn" class="primary-btn">Start Scanner</button>
            
            <div id="scan-result" class="scan-overlay hidden">
                <h3>Scan Success</h3>
                <p id="scan-msg">Updating...</p>
                <button id="scan-again-btn" class="secondary-btn">Scan Next</button>
            </div>
        </div>

        <div id="tab-search" class="view">
            <h2>Find Asset</h2>
            
            <div class="search-container">
                <input type="text" id="search-vin" placeholder="Last 8 of VIN" class="input-field search-input">
                <button id="clear-search-btn" class="secondary-btn clear-btn">X</button>
            </div>

            <button id="search-btn" class="primary-btn">FIND</button>
            
            <div id="search-results" class="result-box hidden">
                <p><strong>PLX ID:</strong> <span id="res-id">--</span></p>
                <p><strong>Customer:</strong> <span id="res-cust">--</span></p>
                <p><strong>Last Seen:</strong> <span id="res-time">--</span></p>
                
                <button id="locate-btn" class="primary-btn" style="display:none; width: 100%; background-color: #03dac6; color: #000; margin-top: 20px; font-weight: bold;">LOCATE</button>
                
                <button id="reprint-btn" class="secondary-btn" style="display:none; width: 100%; border-color: #bb86fc; color: #bb86fc; margin-top: 15px;">Reprint Tag</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <button class="nav-btn active" onclick="switchTab('tab-scan')">Scan</button>
            <button class="nav-btn" onclick="switchTab('tab-register')">Register</button>
            <button class="nav-btn" onclick="switchTab('tab-search')">Search</button>
        </nav>

    </div>

    <script src="app.js"></script>
</body>
</html>